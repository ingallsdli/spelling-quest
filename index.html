<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lincoln's Spelling Quest</title>

<style>
  :root{
    --bg:#0b1220; --text:#e9eefc; --muted:#a9b6da;
    --ok:#33d17a; --bad:#ff5c5c;
    --btn:#1a2644; --btn2:#22335c;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: radial-gradient(1200px 600px at 50% -20%, #1a2c5e 0%, var(--bg) 60%);
    color:var(--text);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
  }
  .card{
    width:min(980px,100%);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border:1px solid rgba(255,255,255,0.10);
    border-radius:18px;
    padding:16px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.35);
  }
  h1{margin:0 0 6px; font-size:28px;}
  .sub{color:var(--muted); margin:0 0 10px; line-height:1.35; font-weight:600;}
  .top{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:10px;}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    background: rgba(44,97,255,0.16);
    border:1px solid rgba(44,97,255,0.25);
    padding:8px 12px; border-radius:999px; font-weight:1000;
  }
  .progress{
    height:12px; border-radius:999px;
    background: rgba(255,255,255,0.10);
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.10);
    flex:1; min-width:220px;
  }
  .bar{
    height:100%;
    background: linear-gradient(90deg, #2c61ff, #9b7bff);
    width:0%;
    transition: width 220ms ease;
  }
  button{
    border:0; cursor:pointer;
    background: var(--btn);
    color: var(--text);
    padding:14px 16px;
    border-radius:14px;
    font-size:18px;
    font-weight:1000;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.10);
    user-select:none;
  }
  button.primary{background: linear-gradient(180deg, #2c61ff, #2a4bcc);}
  button.alt{background: var(--btn2);}
  button.good{background: rgba(51,209,122,0.20); box-shadow: inset 0 0 0 1px rgba(51,209,122,0.30);}
  button.warn{background: rgba(255,92,92,0.18); box-shadow: inset 0 0 0 1px rgba(255,92,92,0.28);}

  .inputWrap{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  input{
    flex:1 1 320px;
    padding:16px 14px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.22);
    color: var(--text);
    font-size:22px;
    font-weight:1000;
    letter-spacing: .8px;
  }
  .msg{
    margin-top:12px;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.18);
    min-height:56px;
    display:flex; align-items:center;
    color: var(--muted);
    line-height:1.3;
    font-weight:900;
  }
  .msg.ok{color:#c9ffe1; border-color: rgba(51,209,122,0.35); background: rgba(51,209,122,0.10);}
  .msg.bad{color:#ffd2d2; border-color: rgba(255,92,92,0.35); background: rgba(255,92,92,0.10);}

  .kbd{
    margin-top:14px;
    display:grid;
    grid-template-columns: repeat(10, minmax(0,1fr));
    gap:10px;
  }
  .k{
    padding:16px 0;
    text-align:center;
    border-radius:14px;
    background: rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.10);
    font-weight:1000;
    font-size:20px;
  }
  .kbd .wider{grid-column: span 3;}
  .tiny{font-size:12px;color:rgba(233,238,252,.7);margin-top:10px;line-height:1.35;}

  /* Celebration overlay */
  #celebration{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    background: radial-gradient(900px 600px at 50% 30%, rgba(255,255,255,0.10), rgba(0,0,0,0.78)),
                linear-gradient(135deg, #2c61ff, #9b7bff);
    z-index:9999;
    overflow:hidden;
    padding:24px;
    text-align:center;
  }
  #celebrationText{
    color:white;
    font-weight:1000;
    font-size: clamp(32px, 6vw, 80px);
    text-shadow: 0 0 20px rgba(0,0,0,0.45);
    animation: flash 0.9s infinite;
    line-height:1.05;
  }
  #celebrationSub{
    margin-top:12px;
    color: rgba(255,255,255,0.92);
    font-size: clamp(16px, 2.2vw, 28px);
    font-weight:900;
    text-shadow: 0 0 14px rgba(0,0,0,0.35);
  }
  #playAgainBtn{
    margin-top:18px;
    font-size:20px;
    padding:14px 18px;
    border-radius:16px;
    background: rgba(51,209,122,0.22);
    box-shadow: inset 0 0 0 1px rgba(51,209,122,0.35);
  }
  @keyframes flash{
    0% { transform: scale(1.00); filter: brightness(1.0); }
    50%{ transform: scale(1.04); filter: brightness(1.15); }
    100%{ transform: scale(1.00); filter: brightness(1.0); }
  }
  .confettiPiece{
    position:fixed;
    width:10px;
    height:10px;
    top:-20px;
    z-index:9998;
    border-radius:2px;
    opacity:0.95;
    will-change: transform;
  }
</style>
</head>

<body>
<div class="card">
  <h1>Lincoln's Spelling Quest</h1>
  <p class="sub">Audio-only spelling. Listen to the word. Type it (or tap letters). Get <b>10 correct</b> to finish your lesson.</p>

  <div class="top">
    <span class="pill">‚≠ê Correct: <span id="count">0</span>/10</span>
    <div class="progress"><div class="bar" id="bar"></div></div>
    <button class="primary" onclick="startNext()">‚ñ∂ Start / Next Word</button>
    <button class="alt" onclick="testVoice()">Test Voice</button>
  </div>

  <div class="inputWrap">
    <input id="answer" placeholder="Type here‚Ä¶" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    <button class="alt" onclick="hearAgain()">üîä Hear Again</button>
    <button class="alt" onclick="giveHint()">üí° Hint</button>
    <button class="good" onclick="checkAnswer()">‚úÖ Check</button>
    <button class="warn" onclick="clearBox()">‚å´ Clear</button>
  </div>

  <div class="msg" id="msg">Tap <b>Start</b> To Begin.</div>
  <div class="kbd" id="kbd"></div>

  <div class="tiny">
    BUILD: <span id="buildStamp"></span><br/>
    Live URL: <b>https://ingallsdli.github.io/spelling-quest/</b><br/>
    After committing, open: <b>https://ingallsdli.github.io/spelling-quest/?v=new</b> then press <b>Ctrl + F5</b>.
  </div>
</div>

<!-- Celebration overlay -->
<div id="celebration">
  <div id="celebrationText">GREAT JOB LINCOLN!!!!</div>
  <div id="celebrationSub">You finished your lesson.</div>
  <button id="playAgainBtn" class="good" onclick="playAgain()">üéâ Play Again (New Lesson)</button>
</div>

<script>
/* ===== Build stamp (to prove newest version loaded) ===== */
document.getElementById("buildStamp").textContent = "2026-02-20-playagain-v3";

/* ===== Settings ===== */
var REQUIRED_CORRECT = 10;
var RATE = 0.71;      // slower voice
var PITCH = 1.08;

/* ===== Word bank (hidden) ===== */
var WORD_BANK = [
  { w:"because", chunk:"be + cause" },
  { w:"before", chunk:"be + fore" },
  { w:"around", chunk:"a + round" },
  { w:"first", chunk:"furst" },
  { w:"found", chunk:"fownd" },
  { w:"would", chunk:"wood" },
  { w:"where", chunk:"wair" },
  { w:"right", chunk:"r + ight" },
  { w:"little", chunk:"lit + tle" },
  { w:"always", chunk:"all + ways" },
  { w:"pretty", chunk:"pret + ty" },
  { w:"people", chunk:"pee + pul" },
  { w:"mother", chunk:"muth + er" },
  { w:"school", chunk:"skool" },
  { w:"friend", chunk:"frend" },
  { w:"should", chunk:"shood" },
  { w:"answer", chunk:"an + ser" },
  { w:"great", chunk:"gr + ate" },
  { w:"different", chunk:"dif + fer + ent" },
  { w:"important", chunk:"im + por + tant" }
];

var PRAISE = [
  "Great job, Lincoln!",
  "You're rocking now, Lincoln!",
  "Keep up the great work, Lincoln!",
  "Awesome spelling, Lincoln!",
  "Nice work, Lincoln!",
  "Way to go, Lincoln!",
  "You‚Äôre getting stronger, Lincoln!"
];

/* ===== State ===== */
var VOICES = [];
var lessonWords = [];
var passed = {};          // map word->true for this lesson
var passedCount = 0;      // number correct (must hit 10)
var current = null;
var attempts = 0;
var hintLevel = 0;
var finished = false;

/* ===== DOM helpers ===== */
function $(id){ return document.getElementById(id); }

function setMsg(html, cls){
  var m = $("msg");
  m.className = "msg" + (cls ? (" " + cls) : "");
  m.innerHTML = html;
}
function updateProgress(){
  $("count").textContent = String(passedCount);
  $("bar").style.width = (Math.min(100, (passedCount / REQUIRED_CORRECT) * 100)) + "%";
}
function normalize(x){
  return (x || "").toLowerCase().replace(/[^a-z']/g,'').trim();
}
function randFrom(arr){
  return arr[Math.floor(Math.random() * arr.length)];
}
function shuffleCopy(arr){
  var a = arr.slice();
  for(var i=a.length-1;i>0;i--){
    var j = Math.floor(Math.random()*(i+1));
    var tmp = a[i]; a[i]=a[j]; a[j]=tmp;
  }
  return a;
}

/* ===== Voices ===== */
function loadVoices(){
  try{ VOICES = speechSynthesis.getVoices() || []; } catch(e){ VOICES = []; }
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function pickFemaleVoice(){
  var preferred = ["Zira","Aria","Jenny"];
  for (var p=0;p<preferred.length;p++){
    for (var i=0;i<VOICES.length;i++){
      var name = (VOICES[i].name || "");
      if (name.indexOf(preferred[p]) !== -1) return VOICES[i];
    }
  }
  for (var k=0;k<VOICES.length;k++){
    var lang = (VOICES[k].lang || "");
    if (lang.indexOf("en") === 0) return VOICES[k];
  }
  return VOICES.length ? VOICES[0] : null;
}

function speak(text, after, afterDelayMs, rate){
  var u = new SpeechSynthesisUtterance(text);
  var v = pickFemaleVoice();
  if (v) u.voice = v;
  u.lang = "en-US";
  u.rate = (typeof rate === "number") ? rate : RATE;
  u.pitch = PITCH;

  if (after){
    u.onend = function(){ setTimeout(after, afterDelayMs || 0); };
    u.onerror = function(){ setTimeout(after, afterDelayMs || 0); };
  }

  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* ===== Lesson management ===== */
function newLesson(){
  finished = false;
  passed = {};
  passedCount = 0;
  current = null;
  attempts = 0;
  hintLevel = 0;
  $("celebration").style.display = "none";
  clearConfetti();

  // random set of 10 each time
  var shuffled = shuffleCopy(WORD_BANK);
  lessonWords = shuffled.slice(0, Math.min(REQUIRED_CORRECT, shuffled.length));

  updateProgress();
  setMsg("Tap <b>Start</b> To Begin.");
}

function remainingWords(){
  var rem = [];
  for (var i=0;i<lessonWords.length;i++){
    if (!passed[lessonWords[i].w]) rem.push(lessonWords[i]);
  }
  return rem;
}

function pickNextWord(){
  if (passedCount >= REQUIRED_CORRECT){
    finishLesson();
    return;
  }
  var rem = remainingWords();
  if (!rem.length){
    finishLesson();
    return;
  }
  current = rem[Math.floor(Math.random()*rem.length)];
  attempts = 0;
  hintLevel = 0;

  $("answer").value = "";
  $("answer").focus();

  setMsg("Listen carefully, then spell the word.");
  speak("Okay Lincoln. The word is " + current.w + ".");
}

/* Start/Next: cannot skip unfinished word */
function startNext(){
  if (finished){
    newLesson();
    pickNextWord();
    return;
  }
  if (!lessonWords.length){
    newLesson();
  }
  if (!current){
    pickNextWord();
    return;
  }

  // if current isn't passed, do NOT advance‚Äîremind
  if (!passed[current.w]){
    setMsg("Spell the word to move on. You can do it, Lincoln!");
    speak("Spell the word to move on, Lincoln. The word is " + current.w + ".");
    return;
  }

  pickNextWord();
}

function hearAgain(){
  if (!current || finished){
    setMsg("Tap <b>Start</b> To Begin.");
    return;
  }
  speak("The word is " + current.w + ".");
}

function giveHint(){
  if (!current || finished){
    setMsg("Tap <b>Start</b> To Begin.");
    return;
  }

  if (hintLevel === 0){
    setMsg("üí° Hint: Listen slowly.");
    speak("Listen slowly: " + current.w + ".", null, 0, 0.60);
  } else if (hintLevel === 1){
    setMsg("üí° Hint: Number of letters.");
    speak("This word has " + current.w.length + " letters.");
  } else if (hintLevel === 2){
    setMsg("üí° Hint: Starting letter.");
    speak("The word starts with " + current.w.charAt(0).toUpperCase() + ".");
  } else {
    setMsg("üí° Hint: Word chunk.");
    speak("Think of it like: " + (current.chunk || "listen to the sounds") + ".");
  }

  hintLevel = Math.min(3, hintLevel + 1);
}

function checkAnswer(){
  if (!current || finished){
    setMsg("Tap <b>Start</b> To Begin.");
    return;
  }

  var ans = normalize($("answer").value);
  if (!ans){
    setMsg("Type (or tap) your answer first.");
    speak("Type your answer first, Lincoln.");
    return;
  }

  var target = normalize(current.w);

  if (ans === target){
    if (!passed[current.w]){
      passed[current.w] = true;
      passedCount++;
      updateProgress();
    }

    var praise = randFrom(PRAISE);
    setMsg("‚úÖ " + praise, "ok");

    // pause 1s AFTER praise ends, then continue
    speak(praise, function(){
      if (passedCount >= REQUIRED_CORRECT){
        finishLesson();
      } else {
        pickNextWord();
      }
    }, 1000);

  } else {
    attempts++;
    setMsg("‚ùå Try again, Lincoln.", "bad");
    speak("Try again, Lincoln.");

    if (attempts === 2 || attempts === 3){
      setTimeout(giveHint, 450);
    }
    if (attempts >= 4){
      $("answer").value = "";
    }
    $("answer").focus();
  }
}

function clearBox(){
  $("answer").value = "";
  $("answer").focus();
}

function testVoice(){
  setMsg("üîä Testing voice‚Ä¶");
  speak("Hello Lincoln. This is your spelling quest voice.");
}

/* ===== Confetti + Finish ===== */
function clearConfetti(){
  var pieces = document.querySelectorAll(".confettiPiece");
  for (var i=0;i<pieces.length;i++) pieces[i].remove();
}

function launchConfetti(){
  clearConfetti();
  var colors = ["#ff3b30","#ffcc00","#34c759","#007aff","#af52de","#ff9500","#00c7be"];
  var count = 200;

  for (var i=0;i<count;i++){
    var piece = document.createElement("div");
    piece.className = "confettiPiece";
    piece.style.background = colors[Math.floor(Math.random()*colors.length)];
    piece.style.left = (Math.random()*100) + "vw";
    piece.style.width = (6 + Math.random()*10) + "px";
    piece.style.height = (6 + Math.random()*14) + "px";
    piece.style.borderRadius = (Math.random() < 0.35) ? "50%" : "2px";
    document.body.appendChild(piece);

    var drift = (Math.random()*40 - 20);
    var fall = (100 + Math.random()*30);

    (function(el, d, f){
      var anim = el.animate([
        { transform:"translateY(0) translateX(0) rotate(0deg)", opacity:1 },
        { transform:"translateY(" + f + "vh) translateX(" + d + "vw) rotate(" + (720 + Math.random()*720) + "deg)", opacity:1 }
      ],{
        duration: 2200 + Math.random()*1200,
        easing: "cubic-bezier(.2,.8,.2,1)"
      });
      anim.onfinish = function(){ el.remove(); };
    })(piece, drift, fall);
  }
}

function finishLesson(){
  finished = true;
  $("celebration").style.display = "flex";
  launchConfetti();
  speak("Great job Lincoln! You finished your lesson!");
  current = null;
}

function playAgain(){
  newLesson();
  pickNextWord();
}

/* ===== Tap keyboard ===== */
var keys = "qwertyuiopasdfghjklzxcvbnm".split("");
function renderKbd(){
  var kbd = $("kbd");
  kbd.innerHTML = "";

  for (var i=0;i<keys.length;i++){
    (function(ch){
      var b = document.createElement("button");
      b.className = "k";
      b.textContent = ch.toUpperCase();
      b.onclick = function(){
        $("answer").value += ch;
        $("answer").focus();
      };
      kbd.appendChild(b);
    })(keys[i]);
  }

  function addWide(label, fn){
    var b = document.createElement("button");
    b.className = "k wider";
    b.textContent = label;
    b.onclick = fn;
    kbd.appendChild(b);
  }

  addWide("‚å´ BACK", function(){
    var v = $("answer").value;
    $("answer").value = v.slice(0,-1);
    $("answer").focus();
  });
  addWide("CLEAR", clearBox);
  addWide("CHECK", checkAnswer);
  addWide("HEAR", hearAgain);
  addWide("HINT", giveHint);
}
renderKbd();

$("answer").addEventListener("keydown", function(e){
  if (e.key === "Enter"){
    e.preventDefault();
    checkAnswer();
  }
});

/* Init */
newLesson();
setTimeout(loadVoices, 500);
setTimeout(loadVoices, 1500);
</script>
</body>
</html>